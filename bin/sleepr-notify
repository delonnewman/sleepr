#!/usr/bin/env perl
use v5.14;
use Getopt::Long;

use lib qw{ lib };
use Sleepr qw{ loop before now format_time };
use Sleepr::Notify qw{ notify };

#
# Process CLI options
GetOptions(help => \my $help, verbose => \my $verbose);

if ( $help ) {
    say "Usage: $0 OPTIONS";
    exit 0;
}

loop {
    my $time = now;
    say "Checking for bedtime at '$time'..." if $verbose;

    before '10min' => sub {
        my ($begin, $end) = @_;

        if ( $begin >= 0 ) {
            notify "It's close to bedtime the system will be
                   shutting down in ", format_time($begin);
        }
        else {
            notify "It's bedtime you've requested that the 
                   system be shutdown for ", format_time($end, 'more');
        }
    }
}
