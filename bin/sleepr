#!/usr/bin/env perl
use v5.14;
use YAML;
use Data::Dump qw{ dump };
use Getopt::Long;

use lib qw{ lib };
use Sleepr qw{ config };

#
# Process CLI options
GetOptions(
    'begin=s'     => \my $begin,
    'end=s'       => \my $end,
    'freq=i'      => \my $freq,
    'show-config' => \my $show,
    'help'        => \my $help
);

if ( $help || !( $begin || $end || $freq || $show ) ) {
    say "Usage: $0 OPTIONS";
    exit 0;
}

my $f      = $Sleepr::CONFIG_FILE;
my $config = YAML::LoadFile($f);

$config->{begin}       = [split ':', $begin] if $begin;
$config->{end}         = [split ':', $end]   if $end;
$config->{check_every} = $freq               if $freq;

my $yaml = YAML::Dump($config);

unless ( $show ) {
    open my $fh, '>', $f or die "Can't write to '$f'";
    print $fh $yaml;
    close $fh;
}

say $yaml;
